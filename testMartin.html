<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Orbit</title>
	<style>
		html, body {
			width: 100%;
			height: 100%;
		}

		body {
			margin: 0;
			overflow: hidden;
		}

	</style>
</head>
<body>

</body>
<script src="js/three.js"></script>
<script src="js/controls/OrbitControls.js"></script>
<script src="js/controls/PointerLockControls.js"></script>
<script src="EEkEy.js"></script>
<script>

	// Scene variables
	var camera, controls, orbit, orbitControls, scene, renderer;

	var havePointLock = 'pointerLockElement' in document;
	var cameraPick = 1;
	var relativeOrbitPosition = 1;

	if(havePointLock) {
		var pointerlockchange = function (event) {
			if(document.pointerLockElement === document.body){
				console.log('PointerLock enabled');
				controlsEnabled = true;
				controls.enabled = true;
			} else {
				console.log('PointerLock disabled');
				controls.enabled = false;
			}
		}
	}

	var pointerlockerror = function (event) {
		console.log('Error!');
	}

	document.addEventListener('pointerlockchange', pointerlockchange, false);
	document.addEventListener('pointerlockerror', pointerlockerror, false);

	init();
	loadWorld();
	animate();

	var controlsEnabled = false;


	function init() {

		// Camera 1
		orbit = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 1000);
		orbit.position.z = 10;

		// Camera 2
		camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 1000);

		// Scene
		scene = new THREE.Scene();
		scene.background = new THREE.Color(0xF0F8FF);
		scene.fog = new THREE.FogExp2(0x25FCB9, 0.0009);

		// Renderer
		renderer = new THREE.WebGLRenderer({antialias: true});
		renderer.setSize(window.innerWidth, window.innerHeight);
		document.body.appendChild(renderer.domElement);

		// OrbitControls
		orbitControls = new THREE.OrbitControls(orbit, renderer.domElement);
		orbitControls.addEventListener('change', render);
		orbitControls.enableZoom = false;

		// PointerLockControls
		controls = new THREE.PointerLockControls(camera);
		scene.add(controls.getObject());

		var onKeyDown = function (event) {
			switch (event.keyCode) {
				case 86: //v
					cameraPick = 2;
					console.log(cameraPick);
					document.body.requestPointerLock();
					break;
				case 67: //c
					cameraPick = 1;
					console.log(cameraPick);
					document.exitPointerLock();
					break;
			}

		};

		document.addEventListener('keydown', onKeyDown, false);
		window.addEventListener('resize', onWindowResize, false);
		document.addEventListener( 'wheel', onMouseWheel);
	}

	var sphere, plane;
	function loadWorld()
	{
		// Sphere
		var geometry = new THREE.SphereGeometry( 5, 32, 32 );
		var material = new THREE.MeshBasicMaterial( {color: 0xffff00} );
		sphere = new THREE.Mesh( geometry, material );
		scene.add( sphere );

		var planeGeometry = new THREE.PlaneGeometry(500, 500, 100, 100);
		var planeMaterial = new THREE.MeshNormalMaterial();
		plane = new THREE.Mesh(planeGeometry, planeMaterial);
		plane.rotation.x = Math.PI / 2;
		plane.position.y = -2.5;
		plane.material.side = THREE.DoubleSide;
		scene.add(plane);

	}

	function onWindowResize() {
		camera.ascpet = orbit.ascpet = window.innerWidth / window.innerHeight;
		camera.updateProjectionMatrix();
		orbit.updateProjectionMatrix();

		renderer.setSize(window.innerWidth, window.innerHeight);

	}

	function animate() {
		requestAnimationFrame(animate);

		sphere.position.y += 0.1;


		orbitControls.target.set(sphere.position.x, sphere.position.y, sphere.position.z);
		orbit.position.y = sphere.position.y + relativeOrbitPosition;
		camera.position.y = sphere.position.y;

		orbitControls.update();


		render();
	}

	function render() {

		// Decides which camera will be used
		if(cameraPick === 1)
			renderer.render(scene, orbit);
		else if(cameraPick === 2)
			renderer.render(scene, camera);
		else
			console.log('Your controls seem to have fucked up');
	}


</script>

</html>
